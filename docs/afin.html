<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/pyodide/v0.19.0/full/pyodide.js"></script>
  </head>

  <body>

    <p>
      Implementación del algoritmo afín. Los parámetros a,b deben ser menores que n (n=26), y primos entre sí.
    </p>
    <input id="message" value="Mensaje secreto" />
    <br>
    <p> Parámetros: </p>
    <input id="p1" value="a" />
    <input id="p2" value="b" />
    <button onclick="run()">Encriptar</button>
    <button onclick="run_decrypt()">Desencriptar</button>
    <br>
    <br>
    <div>Resultado:</div>
    <textarea id="output" style="width: 100%;" rows="1" disabled></textarea>

    <div>
        <p>Código del encriptador:</p>
        <textarea id="encrypt_code" style="width: 100%;" rows="6" disabled></textarea>
    </div>
    
    <div>
        <p>Código del desencriptador:</p>
        <textarea id="decrypt_code" style="width: 100%;" rows="6" disabled></textarea>
    </div>

    <script>
      encrypt = ""

      fetch('./afin_encrypt.py')
          .then(response => response.text())
          .then(data => encrypt=data);

      fetch('./afin_decrypt.py')
          .then(response => response.text())
          .then(data => decrypt=data);
    
      const output = document.getElementById("output");
      const code = document.getElementById("code");

      function addToOutput(s) {
        output.value += s + "\n";
      }

      output.value = "Cargando entorno de Python...\n";
      
      async function main() {
        let pyodide = await loadPyodide({
          indexURL: "https://cdn.jsdelivr.net/pyodide/v0.19.0/full/",
        });
        output.value = "¡Listo!\n";
        
        document.getElementById("encrypt_code").value = encrypt;
        // En rot13 con un alfabeto de 26 letras, las funciones para encriptar
        // y desencriptar son idénticas.
        document.getElementById("decrypt_code").value = decrypt;
        
        return pyodide;
      }

      let pyodideReadyPromise = main();
      


      async function run() {
        let pyodide = await pyodideReadyPromise;

        try {
          output.value = "Encriptando..."
          let result = pyodide.runPython(encrypt);
          output.value = result;
        } catch (err) {
          addToOutput(err);
        }
      }

      async function run_decrypt() {
        let pyodide = await pyodideReadyPromise;

        try {
          output.value = "Desencriptando..."
          let result = pyodide.runPython(decrypt);
          output.value = result;
        } catch (err) {
          addToOutput(err);
        }
      }

    </script>
  </body>
</html>